---
// Importa les dependències necessàries
import { Image } from "astro:assets";
import PrimaryCTA from "@components/ui/buttons/PrimaryCTA.astro";
import SecondaryCTA from "@components/ui/buttons/SecondaryCTA.astro";
import ReviewComponent from "@components/ui/blocks/ReviewComponent.astro";

// Imatges del carrusel
import heroBg1 from "../../../images/hero/hero-bg1.webp";
import heroBg2 from "../../../images/hero/hero-bg2.webp";
import heroBg3 from "../../../images/hero/hero-bg3.webp";
import heroBg4 from "../../../images/hero/hero-bg4.webp";
import heroBg5 from "../../../images/hero/hero-bg5.webp";
import heroBg6 from "../../../images/hero/hero-bg6.webp";

const {
  title,
  subTitle,
  primaryBtn,
  primaryBtnURL,
  secondaryBtn,
  secondaryBtnURL,
  withReview,
  avatars,
  starCount,
  rating,
  reviews,
  src,
  alt,
  slideTitles,
  slideSubtitles
} = Astro.props;

interface Props {
  title: string;
  subTitle?: string;
  primaryBtn?: string;
  primaryBtnURL?: string;
  secondaryBtn?: string;
  secondaryBtnURL?: string;
  withReview?: boolean;
  avatars?: Array<any>;
  starCount?: number;
  rating?: string;
  reviews?: string;
  src?: any;
  alt?: string;
  slideTitles?: string[];
  slideSubtitles?: string[];
}
---

<section
  class="relative mx-auto mt-8 overflow-hidden rounded-3xl px-4 py-24 sm:px-6 lg:px-8 lg:py-32 2xl:max-w-full shadow-xl shadow-black/30 dark:shadow-xl dark:shadow-black/30"
  style="height: 600px;" 
>
  <!-- Vores decoratives -->
  <div class="absolute inset-4 border border-white/20 rounded-2xl z-10 pointer-events-none"></div>
  <div class="absolute top-3 left-3 w-8 h-8 border-t-2 border-l-2 border-white/40 rounded-tl-lg z-10 pointer-events-none"></div>
  <div class="absolute top-3 right-3 w-8 h-8 border-t-2 border-r-2 border-white/40 rounded-tr-lg z-10 pointer-events-none"></div>
  <div class="absolute bottom-3 left-3 w-8 h-8 border-b-2 border-l-2 border-white/40 rounded-bl-lg z-10 pointer-events-none"></div>
  <div class="absolute bottom-3 right-3 w-8 h-8 border-b-2 border-r-2 border-white/40 rounded-br-lg z-10 pointer-events-none"></div>

  <!-- Carrusel d'imatges de fons -->
  <div class="absolute inset-0 overflow-hidden">
    <div id="custom-carousel" class="relative h-full w-full">
      <!-- Slide 1 -->
      <div class="carousel-slide absolute inset-0 opacity-100 transition-opacity duration-1000" data-slide="0">
        <div class="h-full w-full overflow-hidden">
          <Image 
            src={heroBg1} 
            alt="Imatge de fons 1" 
            class="h-full w-full object-cover object-center" 
            style="object-position: center 55%;"
          />
        </div>
      </div>
      <!-- Slide 2 -->
      <div class="carousel-slide absolute inset-0 opacity-0 transition-opacity duration-1000" data-slide="1">
        <div class="h-full w-full overflow-hidden">
          <Image 
            src={heroBg2} 
            alt="Imatge de fons 2" 
            class="h-full w-full object-cover object-center" 
            style="object-position: center 55%;"
          />
        </div>
      </div>
      <!-- Slide 3 -->
      <div class="carousel-slide absolute inset-0 opacity-0 transition-opacity duration-1000" data-slide="2">
        <div class="h-full w-full overflow-hidden">
          <Image 
            src={heroBg3} 
            alt="Imatge de fons 3" 
            class="h-full w-full object-cover object-center" 
            style="object-position: center 60%;"
          />
        </div>
      </div>
      <!-- Slide 4 -->
      <div class="carousel-slide absolute inset-0 opacity-0 transition-opacity duration-1000" data-slide="3">
        <div class="h-full w-full overflow-hidden">
          <Image 
            src={heroBg4} 
            alt="Imatge de fons 4" 
            class="h-full w-full object-cover object-center" 
            style="object-position: center 67%;"
          />
        </div>
      </div>
      <!-- Slide 5 -->
      <div class="carousel-slide absolute inset-0 opacity-0 transition-opacity duration-1000" data-slide="4">
        <div class="h-full w-full overflow-hidden">
          <Image 
            src={heroBg5} 
            alt="Imatge de fons 5" 
            class="h-full w-full object-cover object-center" 
            style="object-position: center 45%;"
          />
        </div>
      </div>
      <!-- Slide 6 -->
      <div class="carousel-slide absolute inset-0 opacity-0 transition-opacity duration-1000" data-slide="5">
        <div class="h-full w-full overflow-hidden">
          <Image 
            src={heroBg6} 
            alt="Imatge de fons 6" 
            class="h-full w-full object-cover object-center" 
            style="object-position: center 60%;"
          />
        </div>
      </div>
    </div>
  </div>

  <!-- Overlay per llegibilitat -->
  <div class="absolute inset-0 bg-neutral-900/10 dark:bg-neutral-900/20"></div>

  <!-- Controls del carrusel -->
  <div class="absolute inset-0 flex items-center justify-between px-4">
    <button type="button" id="carousel-prev" class="z-10 inline-flex h-8 w-8 items-center justify-center rounded-full bg-white/30 p-2 text-white backdrop-blur-sm transition hover:bg-white/50 focus:outline-none dark:bg-neutral-800/30 dark:hover:bg-neutral-800/50">
      <span class="sr-only">Anterior</span>
      <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
      </svg>
    </button>
    <button type="button" id="carousel-next" class="z-10 inline-flex h-8 w-8 items-center justify-center rounded-full bg-white/30 p-2 text-white backdrop-blur-sm transition hover:bg-white/50 focus:outline-none dark:bg-neutral-800/30 dark:hover:bg-neutral-800/50">
      <span class="sr-only">Següent</span>
      <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
      </svg>
    </button>
  </div>

  <!-- Indicadors del carrusel -->
  <div class="absolute bottom-4 start-1/2 z-10 -translate-x-1/2">
    <div class="flex items-center justify-center space-x-2" id="carousel-indicators">
      <button class="carousel-indicator inline-block h-2 w-2 cursor-pointer rounded-full border border-white bg-white" data-slide="0" aria-label="Vés a la diapositiva 1"></button>
      <button class="carousel-indicator inline-block h-2 w-2 cursor-pointer rounded-full border border-white/50 bg-white/30" data-slide="1" aria-label="Vés a la diapositiva 2"></button>
      <button class="carousel-indicator inline-block h-2 w-2 cursor-pointer rounded-full border border-white/50 bg-white/30" data-slide="2" aria-label="Vés a la diapositiva 3"></button>
      <button class="carousel-indicator inline-block h-2 w-2 cursor-pointer rounded-full border border-white/50 bg-white/30" data-slide="3" aria-label="Vés a la diapositiva 4"></button>
      <button class="carousel-indicator inline-block h-2 w-2 cursor-pointer rounded-full border border-white/50 bg-white/30" data-slide="4" aria-label="Vés a la diapositiva 5"></button>
      <button class="carousel-indicator inline-block h-2 w-2 cursor-pointer rounded-full border border-white/50 bg-white/30" data-slide="5" aria-label="Vés a la diapositiva 6"></button>
    </div>
  </div>

  <!-- Contingut alineat a l'esquerra -->
  <div class="relative mx-auto max-w-[85rem] text-left h-[350px] flex flex-col justify-center">
    <h1
      class="max-w-3xl text-4xl font-bold tracking-tight text-white sm:text-5xl lg:text-6xl lg:leading-tight drop-shadow-lg text-shadow-lg slide-title"
      style="text-shadow: 0 2px 4px rgba(0,0,0,0.5), 0 4px 8px rgba(0,0,0,0.3); height: 140px; display: block;"
    >
      <span class="slide-title-content active" data-slide="0">
        <Fragment set:html={slideTitles ? slideTitles[0] : title} />
      </span>
      {slideTitles && slideTitles.slice(1).map((slideTitle, index) => (
        <span class="slide-title-content hidden" data-slide={index + 1}>
          <Fragment set:html={slideTitle} />
        </span>
      ))}
    </h1>
    
    <p
      class="mt-6 max-w-2xl text-pretty text-xl leading-relaxed text-white/90 dark:text-white/80 drop-shadow-md slide-subtitle"
      style="text-shadow: 0 1px 3px rgba(0,0,0,0.4), 0 2px 6px rgba(0,0,0,0.2); height: 80px; display: flex; align-items: flex-start;"
    >
      <span class="slide-subtitle-content active" data-slide="0">
        {slideSubtitles ? slideSubtitles[0] : subTitle}
      </span>
      {slideSubtitles && slideSubtitles.slice(1).map((slideSubtitle, index) => (
        <span class="slide-subtitle-content hidden" data-slide={index + 1}>
          {slideSubtitle}
        </span>
      ))}
    </p>
    <div class="mt-10 flex flex-col items-start gap-4 sm:flex-row">
      {primaryBtn && 
      <PrimaryCTA title={primaryBtn} url={primaryBtnURL} />
      }
      {secondaryBtn && 
      <SecondaryCTA title={secondaryBtn} url={secondaryBtnURL} />
      }
    </div>
  </div>
</section>

<script is:inline>
  document.addEventListener('DOMContentLoaded', function() {
    var slides = document.querySelectorAll('.carousel-slide');
    var indicators = document.querySelectorAll('.carousel-indicator');
    var prevButton = document.getElementById('carousel-prev');
    var nextButton = document.getElementById('carousel-next');
    if (!slides.length || !indicators.length || !prevButton || !nextButton) {
      console.warn('Falten alguns elements del carrusel');
      return;
    }
    var totalSlides = slides.length;
    var currentSlide = 0;
    var intervalId = null;
    // Elements per als títols i subtítols de cada diapositiva
    var slideTitleContents = document.querySelectorAll('.slide-title-content');
    var slideSubtitleContents = document.querySelectorAll('.slide-subtitle-content');
    function showSlide(index) {
      // Amagar totes les diapositives
      for (var i = 0; i < slides.length; i++) {
        slides[i].classList.remove('opacity-100');
        slides[i].classList.add('opacity-0');
      }
      
      // Actualitzar els indicadors
      for (var j = 0; j < indicators.length; j++) {
        indicators[j].classList.remove('bg-white', 'border-white');
        indicators[j].classList.add('bg-white/30', 'border-white/50');
      }
      
      // Mostrar la diapositiva actual
      slides[index].classList.remove('opacity-0');
      slides[index].classList.add('opacity-100');
      
      // Actualitzar l'indicador actual
      indicators[index].classList.remove('bg-white/30', 'border-white/50');
      indicators[index].classList.add('bg-white', 'border-white');
      
      // Actualitzar els títols i subtítols
      if (slideTitleContents.length > 0 && slideSubtitleContents.length > 0) {
        // Amagar tots els títols i subtítols
        slideTitleContents.forEach(function(titleContent) {
          titleContent.classList.remove('active');
          titleContent.classList.add('hidden');
        });
        
        slideSubtitleContents.forEach(function(subtitleContent) {
          subtitleContent.classList.remove('active');
          subtitleContent.classList.add('hidden');
        });
        
        // Mostrar el títol i subtítol de la diapositiva actual
        var currentTitleContent = document.querySelector('.slide-title-content[data-slide="' + index + '"]');
        var currentSubtitleContent = document.querySelector('.slide-subtitle-content[data-slide="' + index + '"]');
        
        if (currentTitleContent) {
          currentTitleContent.classList.remove('hidden');
          currentTitleContent.classList.add('active');
        }
        
        if (currentSubtitleContent) {
          currentSubtitleContent.classList.remove('hidden');
          currentSubtitleContent.classList.add('active');
        }
      }
      
      currentSlide = index;
    }
    function prevSlide() {
      var newIndex = currentSlide - 1;
      if (newIndex < 0) newIndex = totalSlides - 1;
      showSlide(newIndex);
    }
    function nextSlide() {
      var newIndex = currentSlide + 1;
      if (newIndex >= totalSlides) newIndex = 0;
      showSlide(newIndex);
    }
    function startAutoplay() {
      if (!intervalId) {
        intervalId = window.setInterval(nextSlide, 5000);
      }
    }
    function stopAutoplay() {
      if (intervalId) {
        clearInterval(intervalId);
        intervalId = null;
      }
    }
    prevButton.addEventListener('click', function() {
      prevSlide();
      stopAutoplay();
      startAutoplay();
    });
    nextButton.addEventListener('click', function() {
      nextSlide();
      stopAutoplay();
      startAutoplay();
    });
    for (var k = 0; k < indicators.length; k++) {
      (function(index) {
        indicators[index].addEventListener('click', function() {
          showSlide(index);
          stopAutoplay();
          startAutoplay();
        });
      })(k);
    }
    showSlide(0);
    startAutoplay();
  });
</script>
