---
// Import the necessary dependencies
import { Image } from "astro:assets";
import PrimaryCTA from "@components/ui/buttons/PrimaryCTA.astro";
import SecondaryCTA from "@components/ui/buttons/SecondaryCTA.astro";
import ReviewComponent from "@components/ui/blocks/ReviewComponent.astro";

// Importar las imágenes del carrusel
import heroBg1 from "../../../images/hero/hero-bg1.webp";
import heroBg2 from "../../../images/hero/hero-bg2.webp";
import heroBg3 from "../../../images/hero/hero-bg3.webp";
import heroBg4 from "../../../images/hero/hero-bg4.webp";
import heroBg5 from "../../../images/hero/hero-bg5.webp";
import heroBg6 from "../../../images/hero/hero-bg6.webp";

// Define props from Astro
const {
  title,
  subTitle,
  primaryBtn,
  primaryBtnURL,
  secondaryBtn,
  secondaryBtnURL,
  withReview,
  avatars,
  starCount,
  rating,
  reviews,
  src,
  alt,
  slideTitles,
  slideSubtitles
} = Astro.props;

// Define TypeScript interface for props
interface Props {
  title: string;
  subTitle?: string;
  primaryBtn?: string;
  primaryBtnURL?: string;
  secondaryBtn?: string;
  secondaryBtnURL?: string;
  withReview?: boolean;
  avatars?: Array<any>; // Aceptar tanto ImageMetadata como string
  starCount?: number;
  rating?: string;
  reviews?: string;
  src?: any;
  alt?: string;
  slideTitles?: string[];
  slideSubtitles?: string[];
}
---

<!-- Hero section con carrusel de imágenes de fondo personalizado -->
<section
  class="relative mx-auto mt-8 overflow-hidden rounded-3xl px-4 py-24 sm:px-6 lg:px-8 lg:py-32 2xl:max-w-full shadow-xl shadow-black/30 dark:shadow-xl dark:shadow-black/30"
  style="height: 600px;" 
>
  <!-- Borde interior decorativo -->
  <div class="absolute inset-4 border border-white/20 rounded-2xl z-10 pointer-events-none"></div>
  
  <!-- Elementos decorativos en las esquinas -->
  <div class="absolute top-3 left-3 w-8 h-8 border-t-2 border-l-2 border-white/40 rounded-tl-lg z-10 pointer-events-none"></div>
  <div class="absolute top-3 right-3 w-8 h-8 border-t-2 border-r-2 border-white/40 rounded-tr-lg z-10 pointer-events-none"></div>
  <div class="absolute bottom-3 left-3 w-8 h-8 border-b-2 border-l-2 border-white/40 rounded-bl-lg z-10 pointer-events-none"></div>
  <div class="absolute bottom-3 right-3 w-8 h-8 border-b-2 border-r-2 border-white/40 rounded-br-lg z-10 pointer-events-none"></div>
  
  <!-- Carrusel de imágenes de fondo -->
  <div class="absolute inset-0 overflow-hidden">
    <div id="custom-carousel" class="relative h-full w-full">
      <!-- Slide 1 -->
      <div class="carousel-slide absolute inset-0 opacity-100 transition-opacity duration-1000" data-slide="0">
        <div class="h-full w-full overflow-hidden">
          <Image 
            src={heroBg1} 
            alt="Background image 1" 
            class="h-full w-full object-cover object-center" 
            style="object-position: center 55%;"
          />
        </div>
      </div>
      <!-- Slide 2 -->
      <div class="carousel-slide absolute inset-0 opacity-0 transition-opacity duration-1000" data-slide="1">
        <div class="h-full w-full overflow-hidden">
          <Image 
            src={heroBg2} 
            alt="Background image 2" 
            class="h-full w-full object-cover object-center" 
            style="object-position: center 55%;"
          />
        </div>
      </div>
      <!-- Slide 3 -->
      <div class="carousel-slide absolute inset-0 opacity-0 transition-opacity duration-1000" data-slide="2">
        <div class="h-full w-full overflow-hidden">
          <Image 
            src={heroBg3} 
            alt="Background image 3" 
            class="h-full w-full object-cover object-center" 
            style="object-position: center 75%;"
          />
        </div>
      </div>
      <!-- Slide 4 -->
      <div class="carousel-slide absolute inset-0 opacity-0 transition-opacity duration-1000" data-slide="3">
        <div class="h-full w-full overflow-hidden">
          <Image 
            src={heroBg4} 
            alt="Background image 4" 
            class="h-full w-full object-cover object-center" 
            style="object-position: center 67%;"
          />
        </div>
      </div>
      <!-- Slide 5 -->
      <div class="carousel-slide absolute inset-0 opacity-0 transition-opacity duration-1000" data-slide="4">
        <div class="h-full w-full overflow-hidden">
          <Image 
            src={heroBg5} 
            alt="Background image 5" 
            class="h-full w-full object-cover object-center" 
            style="object-position: center 45%;"
          />
        </div>
      </div>
      <!-- Slide 6 -->
      <div class="carousel-slide absolute inset-0 opacity-0 transition-opacity duration-1000" data-slide="5">
        <div class="h-full w-full overflow-hidden">
          <Image 
            src={heroBg6} 
            alt="Background image 6" 
            class="h-full w-full object-cover object-center" 
            style="object-position: center 60%;"
          />
        </div>
      </div>
    </div>
  </div>
  
  <!-- Overlay muy ligero para mantener legibilidad del texto sin oscurecer demasiado las imágenes -->
  <div class="absolute inset-0 bg-neutral-900/10 dark:bg-neutral-900/20"></div>
  
  <!-- Controles del carrusel -->
  <div class="absolute inset-0 flex items-center justify-between px-4">
    <button type="button" id="carousel-prev" class="z-10 inline-flex h-8 w-8 items-center justify-center rounded-full bg-white/30 p-2 text-white backdrop-blur-sm transition hover:bg-white/50 focus:outline-none dark:bg-neutral-800/30 dark:hover:bg-neutral-800/50">
      <span class="sr-only">Previous</span>
      <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
      </svg>
    </button>
    <button type="button" id="carousel-next" class="z-10 inline-flex h-8 w-8 items-center justify-center rounded-full bg-white/30 p-2 text-white backdrop-blur-sm transition hover:bg-white/50 focus:outline-none dark:bg-neutral-800/30 dark:hover:bg-neutral-800/50">
      <span class="sr-only">Next</span>
      <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
      </svg>
    </button>
  </div>
  
  <!-- Indicadores del carrusel -->
  <div class="absolute bottom-4 start-1/2 z-10 -translate-x-1/2">
    <div class="flex items-center justify-center space-x-2" id="carousel-indicators">
      <button class="carousel-indicator inline-block h-2 w-2 cursor-pointer rounded-full border border-white bg-white" data-slide="0" aria-label="Go to slide 1"></button>
      <button class="carousel-indicator inline-block h-2 w-2 cursor-pointer rounded-full border border-white/50 bg-white/30" data-slide="1" aria-label="Go to slide 2"></button>
      <button class="carousel-indicator inline-block h-2 w-2 cursor-pointer rounded-full border border-white/50 bg-white/30" data-slide="2" aria-label="Go to slide 3"></button>
      <button class="carousel-indicator inline-block h-2 w-2 cursor-pointer rounded-full border border-white/50 bg-white/30" data-slide="3" aria-label="Go to slide 4"></button>
      <button class="carousel-indicator inline-block h-2 w-2 cursor-pointer rounded-full border border-white/50 bg-white/30" data-slide="4" aria-label="Go to slide 5"></button>
      <button class="carousel-indicator inline-block h-2 w-2 cursor-pointer rounded-full border border-white/50 bg-white/30" data-slide="5" aria-label="Go to slide 6"></button>
    </div>
  </div>
  
  <!-- Contenedor del contenido justificado a la izquierda con altura fija -->
  <div class="relative mx-auto max-w-[85rem] text-left h-[350px] flex flex-col justify-center">
    <!-- Título con mayor contraste y sombra para legibilidad sobre imagen -->
    <h1
      class="max-w-3xl text-4xl font-bold tracking-tight text-white sm:text-5xl lg:text-6xl lg:leading-tight drop-shadow-lg text-shadow-lg slide-title"
      style="text-shadow: 0 2px 4px rgba(0,0,0,0.5), 0 4px 8px rgba(0,0,0,0.3); height: 140px; display: block;"
    >
      <span class="slide-title-content active" data-slide="0">
        <Fragment set:html={slideTitles ? slideTitles[0] : title} />
      </span>
      {slideTitles && slideTitles.slice(1).map((slideTitle, index) => (
        <span class="slide-title-content hidden" data-slide={index + 1}>
          <Fragment set:html={slideTitle} />
        </span>
      ))}
    </h1>
    
    <p
      class="mt-6 max-w-2xl text-pretty text-xl leading-relaxed text-white/90 dark:text-white/80 drop-shadow-md slide-subtitle"
      style="text-shadow: 0 1px 3px rgba(0,0,0,0.4), 0 2px 6px rgba(0,0,0,0.2); height: 80px; display: flex; align-items: flex-start;"
    >
      <span class="slide-subtitle-content active" data-slide="0">
        {slideSubtitles ? slideSubtitles[0] : subTitle}
      </span>
      {slideSubtitles && slideSubtitles.slice(1).map((slideSubtitle, index) => (
        <span class="slide-subtitle-content hidden" data-slide={index + 1}>
          {slideSubtitle}
        </span>
      ))}
    </p>
    
    <!-- Botones alineados a la izquierda -->
    <div class="mt-10 flex flex-col items-start gap-4 sm:flex-row">
      {primaryBtn && 
      <PrimaryCTA title={primaryBtn} url={primaryBtnURL} />
      }
      {secondaryBtn && 
      <SecondaryCTA title={secondaryBtn} url={secondaryBtnURL} />
      }
    </div>

    <!-- Se ha eliminado la sección de reseñas con estrellas -->
  </div>
</section>

<!-- Script para controlar el carrusel personalizado -->
<script is:inline>
  document.addEventListener('DOMContentLoaded', function() {
    // Variables para controlar el carrusel
    var slides = document.querySelectorAll('.carousel-slide');
    var indicators = document.querySelectorAll('.carousel-indicator');
    var prevButton = document.getElementById('carousel-prev');
    var nextButton = document.getElementById('carousel-next');
    
    // Verificar que los elementos existen antes de continuar
    if (!slides.length || !indicators.length || !prevButton || !nextButton) {
      console.warn('Algunos elementos del carrusel no se encontraron');
      return;
    }
    
    var totalSlides = slides.length;
    var currentSlide = 0;
    var intervalId = null;
    
    // Elements for titles and subtitles for each slide
    var slideTitleContents = document.querySelectorAll('.slide-title-content');
    var slideSubtitleContents = document.querySelectorAll('.slide-subtitle-content');
    
    // Function to show a specific slide
    function showSlide(index) {
      // Hide all slides
      for (var i = 0; i < slides.length; i++) {
        slides[i].classList.remove('opacity-100');
        slides[i].classList.add('opacity-0');
      }
      
      // Update indicators
      for (var i = 0; i < indicators.length; i++) {
        indicators[i].classList.remove('bg-white');
        indicators[i].classList.add('bg-white/30');
        indicators[i].classList.remove('border-white');
        indicators[i].classList.add('border-white/50');
      }
      
      // Show the selected slide
      slides[index].classList.remove('opacity-0');
      slides[index].classList.add('opacity-100');
      
      // Update the selected indicator
      indicators[index].classList.remove('bg-white/30');
      indicators[index].classList.add('bg-white');
      indicators[index].classList.remove('border-white/50');
      indicators[index].classList.add('border-white');
      
      // Update titles and subtitles
      if (slideTitleContents.length > 0 && slideSubtitleContents.length > 0) {
        // Hide all titles and subtitles
        slideTitleContents.forEach(function(titleContent) {
          titleContent.classList.remove('active');
          titleContent.classList.add('hidden');
        });
        
        slideSubtitleContents.forEach(function(subtitleContent) {
          subtitleContent.classList.remove('active');
          subtitleContent.classList.add('hidden');
        });
        
        // Show the title and subtitle for the current slide
        var currentTitleContent = document.querySelector('.slide-title-content[data-slide="' + index + '"]');
        var currentSubtitleContent = document.querySelector('.slide-subtitle-content[data-slide="' + index + '"]');
        
        if (currentTitleContent) {
          currentTitleContent.classList.remove('hidden');
          currentTitleContent.classList.add('active');
        }
        
        if (currentSubtitleContent) {
          currentSubtitleContent.classList.remove('hidden');
          currentSubtitleContent.classList.add('active');
        }
      }
      
      // Update the current index
      currentSlide = index;
    }
    
    // Función para avanzar a la siguiente diapositiva
    function nextSlide() {
      var next = (currentSlide + 1) % totalSlides;
      showSlide(next);
    }
    
    // Función para retroceder a la diapositiva anterior
    function prevSlide() {
      var prev = (currentSlide - 1 + totalSlides) % totalSlides;
      showSlide(prev);
    }
    
    // Configurar el intervalo para cambiar automáticamente las diapositivas
    function startAutoSlide() {
      intervalId = setInterval(function() {
        nextSlide();
      }, 5000); // Cambiar cada 5 segundos
    }
    
    // Detener el cambio automático
    function stopAutoSlide() {
      if (intervalId) {
        clearInterval(intervalId);
        intervalId = null;
      }
    }
    
    // Agregar eventos a los botones de navegación
    prevButton.addEventListener('click', function() {
      prevSlide();
      stopAutoSlide();
      startAutoSlide();
    });
    
    nextButton.addEventListener('click', function() {
      nextSlide();
      stopAutoSlide();
      startAutoSlide();
    });
    
    // Agregar eventos a los indicadores
    indicators.forEach(function(indicator, index) {
      indicator.addEventListener('click', function() {
        showSlide(index);
        stopAutoSlide();
        startAutoSlide();
      });
    });
    
    // Iniciar el carrusel
    startAutoSlide();
  });
</script>
